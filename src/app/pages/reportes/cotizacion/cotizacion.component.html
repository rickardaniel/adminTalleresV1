<app-nav-bar> </app-nav-bar>
<app-sidebar-reporte></app-sidebar-reporte>

<div class="main-panel animated fadeIn">
    <button class="btn" id="boton-sidebar_left" style="float: right; margin-right: 1em;margin-top: 7em;"><i class="fas fa-angle-double-left" ></i></button>
    <div class="content" id="main">
      <!-- <p class="p1" style="margin-top: 2em;">Cotizaciones</p> -->
      <p id="titulos" style="margin-top: 3.5em; text-align: center;" >Cotizaciones</p>

       <!-- ============================================= BUSCADOR POR FECHA ================================================= -->
 

       <div class="container">
        <form [formGroup]="formReporte">
          <div class="container  mb-4 mt-4">
            <div class="row divSelect">
              <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6 col-xs-12 mb-2">
                <label id="labelReporte" class=" text-white p-1 font-weight-bold rounded w-100 text-center mb-0 calendar">
                  Desde: <i class="far fa-calendar"></i>
                </label>
                <input formControlName="fechaI" type="date" class="form-control"  style="height: 1.9em;" />
              </div>
              <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6 col-xs-12 mb-2">
                <label id="labelReporte" class="text-white p-1 font-weight-bold rounded w-100 text-center mb-0 calendar">
                  Hasta: <i class="fas fa-calendar"></i>
                </label>
                <input formControlName="fechaF" type="date" class="form-control"   style="height: 1.9em;"/>
              </div>      
              <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6 col-xs-12 mb-2 ">
                <button
                  class="col-sm btn btn-sm btnTrash mt-3  "
                  style="font-size: small;"
                  (click)="buscarInformacionReporte(formReporte.value)"
                ><i class="fas fa-search"></i>
                  Buscar 
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>

       <!-- ==========================================   BUSCADOR TABLA REPORTES =============================================== -->
<div class="container "  *ngIf="banderaSearchExcel">
  <div class="row">
  <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12 divSelect mb-2" >
    <div id="search-autocomplete" class="form-outline">
      <input type="search" id="form1" class="form-control"  [(ngModel)]="searchText"   style="border-bottom: 1px solid silver; height: 2.5em;" placeholder=""/>
      <label class="form-label" for="form1">Buscar orden</label>
    </div>
    <button type="submit" class="btn btnLupa" style="height: 2.5em; " >
      <i class="fas fa-search" style="color: white;"></i>
    </button>
  </div>
  <div class="col-xl-6 col-lg-5 col-md-6 col-sm-12 col-xs-12 divSelect">
  
    <div class="">
      <button class="btn btn-sm btn-outline-success btO" (click)="exportarEXCEL()"> <i class="fas fa-file-excel"></i> EXCEL</button>
    </div>
    <div class="">
      <button class="btn btn-sm btn-outline-danger btO"  (click)="exportarPDF()" > <i class="fas fa-file-pdf"></i> PDF</button>
    </div>
  </div>
</div>

</div>

      <!-- ============================================== TABLA REPORTES =========================================================== -->
<div class="table-responsive" style="box-shadow: 0px 4px 8px -4px #a9a8a8; border-radius: 1%;" >
 
  <table mdbTable  #tableEl="mdbTable" class="z-depth-1 mt-2" id="tablaCotizaciones">
    <thead class="thead1">
      <tr class="text-center" > 
      
        <th>#Orden</th>
        <th>Fecha</th>
        <th>Cliente</th>
        <th>Placa</th>
        <th> Marca</th>
        <th> Km</th>  
        <th>Observacion</th>   
        <th>Cambiar a Orden</th>
        <th><i class="fas fa-tools"></i> Acciones</th>
      </tr>
    </thead>
    <tbody  *ngIf="banderaPaginador">
      <tr>
        <td style="border-color: aliceblue;"  colspan="9" class="text-center">
          <!-- <p style="font-weight: bold;">Sin criterios de búsqueda</p> -->
          <img src="./assets/img/icons-no-report.svg" style="width: 100%; height: 20em;">
        </td>
      </tr>
    </tbody>
    <tbody hidden class="tbody" id="tablaPresentar">
      <tr mdbTableCol *ngFor="let el of arregloProvisional; let i = index " class="text-center" >
        <td *ngIf="i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex"  >{{ el.no }}</td>
        <td *ngIf="i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex">{{ el.fecha }}</td>
        <td *ngIf="i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex">{{ el.cliente | titlecase }}</td>
                  <td *ngIf=" i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex" class="fw-bold">{{el.arrayValAuto[0]}}</td>
                  <td *ngIf=" i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex ">{{el.arrayValAuto[1]}}</td>
                  <td *ngIf=" i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex ">{{el.arrayValAuto[2]}}</td>

        <td  *ngIf=" i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex">{{ el.problema }}</td>
        <td  *ngIf="i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex" >

          <div class="button-group btn-group-sm">
            <button
            type="button"
            class="btn" 
            title="CAMBIAR COTIZACIÓN A ORDEN DE TRABAJO"
            (click)="cambiarAOrden(el.id); enviarIdOrden(el.id);"
            style="color: white; background-color: #ffc107;">
             <i class="fas fa-exchange-alt"></i>
          </button>
          </div>
    
        </td>

        <td *ngIf="i+1 >= mdbTablePagination.firstItemIndex && i < mdbTablePagination.lastItemIndex && ( el.estado == '1.ACTIVO' && el.facturado !='1')"  class="divSelect">
          <div class="button-group  btn-group-sm" style="width: 14em;">
            <button
              type="button"
              class="btn btR "
              title="VER ORDEN EN PDF"
              (click)="visualizarPDF(el.id)"
            >
            <i class="fas fa-print"></i>
            </button>
            <button
              type="button"
              class="btn btPrint" 
              title="ENVIAR ORDEN POR CORREO"     
              (click)="enviarCorreo(el.id)"
            >
            <i class="fas fa-envelope"></i>
            </button>
            <button
            type="button"
            class="btn btn-success "
            title="ENVIAR ORDEN POR WHATSAPP"
            (click)="sendWhatsApp(el.id);"
          >
          <i class="fab fa-whatsapp"></i>
          </button>
            <!-- <button class="btn btn-white"  id="openMG" (click)="openModal()" (click)="enviarIdOrden(el.id)"> -->
            <button class="btn" style="background-color: rgba(233, 231, 231, 0.829);color: black;"  id="openMG" 
            (click)="openModal()"
            title="EDITAR COTIZACIÓN"
            (click)="enviarIdOrden(el.id)">
              <i class="fas fa-pencil-alt"></i>
            </button>
 
          </div>
        </td>

      </tr>
      <td class="" colspan="11">
        <mdb-table-pagination
        hidden
        id="pag"
         class=""
         [tableEl]="tableEl"
         [searchDataSource]="arregloProvisional"          
       ></mdb-table-pagination>
      </td>
    </tbody>
 
  </table>
</div>
    </div>
</div>

<!-- //MODAL EDITAR COTIZACION -->


 <div id="ModalCrear" class="modal fade " role="dialog" style="overflow-y: scroll;"> 
    <div class="modal-dialog modal-dialog-centered">

    <div class="modal-content" >
        <div class="modal-header" style="background-color:rgba(233, 231, 231, 0.829) ;">
            <h5 class="modal-title"  style=" font-family: 'Roboto'; font-weight: bold;">Editar Cotización</h5>
            <!-- <button type="button" class="btn" data-dismiss="modal"  ><i class="fas fa-times"></i></button> -->
        </div>
        <div class="modal-body" style="background-color: whitesmoke">
                
     
        <div class=" mt-4 mb-4">
          <div class="col" >
            <div class="row divSelect">
              <button class="btn btnEdit  mt-2"  style="width: 13em;"  data-toggle="modal" data-target="#modalEV"  (click)="enviarAtributoVehiculo()" >  <i class="fas fa-file-invoice-dollar"></i> Editar Cotización</button>
            </div>
            <div class="row divSelect">
              <button class="btn btnTrash  mt-2"  style="width: 13em;"   data-toggle="modal" data-target="#modalEPS" (click)="enviarPyS()" > <i class="fas fa-shopping-cart"></i> Editar Productos</button>
            </div>
            <div class="row divSelect">
              <button class="btn  mt-2" style="background-color: rgba(233, 231, 231, 0.829); color: black; width: 13em;"  data-dismiss="modal"   > <i class="fas fa-sign-out-alt"></i> Salir </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
 </div>

    <!-- ===================================== MODAL EDITAR COTIZACION ========================================= -->

      <div class="modal fade bd-example-modal-xl"   id="modalEV" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"  style="overflow-y: scroll;">
        <div class="modal-dialog modal-xl">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title " id="exampleModalLabel" style=" font-family: 'Roboto'; font-weight: bold;">Editar Datos de la Cotización</h5>
        </div>
        <div>
             <form [formGroup]="formEditarVehiculo">               
            
                <div class="container">
                  <div class="row">
                <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12 col-xs-12 mb-2 ">
                <h5 class="mt-4 mb-3 text-center ">Datos Vehículo <i class="fas fa-car-side"></i></h5>
                <div class="row pl-3 pr-3">
                  <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-xs-6" *ngFor="let el of atributos; let i=index" >
                  <div class="input-group input-group-sm mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text titleAtributo"  id="inputGroup-sizing-sm">{{el.atributo |titlecase}} :</span>
                      </div>
                      <input type="text" class="form-control"  id="floatingInputNombre1{{i}}"  value="{{el.valor}}" >
                    </div>
                  </div>
              </div>
            </div>
            <div class="col-xl-6 col-lg-12 " >
              <h5 class="mt-4 mb-3 text-center ">Observación <i class="fas fa-eye"></i></h5>
              <textarea class="form-control"  formControlName="problema" rows="4" value="{{problema}}" ></textarea>           
            </div>
            </div>
          </div>

          <div class="container">

          <div class="row ">
             <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-xs-12 mb-2 ">
              <h5 class="mt-4 mb-2 text-center">Técnico <i class="fas fa-user-cog"></i></h5>
                  <select class="custom-select"  formControlName="tecnico_id" >
                    <option selected value="">{{tecnico |titlecase}}</option>
                    <ng-container *ngFor="let tec of tecnicos" >
                    <option *ngIf="tecID != tec.id" value="{{tec.id}}" >{{tec.nombres | titlecase}} {{tec.apellidos | titlecase}} </option>
                  </ng-container>
                  </select>

             </div>
             <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-xs-12  mb-2 ">
              <h5 class="mt-4 mb-2 text-center ">Servicio <i class="far fa-calendar"></i></h5>
              <select class="custom-select" formControlName="servicio_id" >
                <option value="" selected  >{{servicio |titlecase}}</option>
                <ng-container *ngFor="let serv of servicios" >
                  <option *ngIf="servID != serv.id" value=" {{serv.id}}" >{{serv.tipo | titlecase}} </option>
                </ng-container>
              </select>

             </div>
             <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-xs-12  mb-2 ">
              <h5 class="mt-4 mb-2 text-center">Prioridad <i class="fas fa-list-alt"></i></h5>
              <select class="custom-select" formControlName="prioridad_id">
                <option value="" selected>{{prioridad |titlecase}}</option>
                <ng-container *ngFor="let pri of prioridades" >
                  <option *ngIf="priID != pri.pri_id" value="{{pri.pri_id}}" >{{pri.nombre | titlecase}} </option>
                </ng-container>
              </select>

             </div>
          </div>
        </div>

            <div class="divSelect mt-4 mb-4">
              <button class="btn bExit btO" (click)="cerrarMODAL()"><i class="fas fa-times"></i> Cancelar </button>
              <button class="btn  bSave btO" (click)="editarCotizacionDATOS(formEditarVehiculo.value)"><i class="fas fa-save"></i> Guardar </button>
            </div>           
             </form>   
        </div>
        </div>
        </div>
    </div>


     <!-- ===================================== MODAL EDITAR COMPRA ========================================= -->

     <div class="modal fade bd-example-modal-xl"   id="modalEPS" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="overflow-y: scroll;">
      <div class="modal-dialog modal-xl">


        
     <!-- <ng-template #modalEPS class="modal fade" > -->
      <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title text-secondary" id="exampleModalLabel" style=" font-family: 'Roboto'; font-weight: bold;"> Editar Productos </h5>
      </div>
      <div>

 
           <form [formGroup]="formEditarPYS">               
            
              <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12 mr-1 mb-2 pl-3 pr-3" style=" border-radius: 0.5em; border-width: 1px; border-color:silver; border-style:solid;">
                <div class="" style="margin-top: 2em;" >
                  <div class="row  divSelect ">
            
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12" style="text-align: left;">
                      <form [formGroup]="formBusquedaN" class="login100-form validate-form flex-sb flex-w animated text-center">
          
                          <div class="input-group justify-content-center" style="align-items: center;">
                              <div id="search-autocomplete" class="form-outline">
                              <input type="search" id="form1" class="form-control"  formControlName="nombre"  style="border-bottom: 1px solid silver; height: 2.5em;" placeholder=""/>
                              <label class="form-label" for="form1">Nombre Producto</label>
                              </div>
                              <button 
                              [disabled]="formBusquedaN.invalid"
                              type="submit" class="btn btnLupa"  (click)="buscarProductoServicio(formBusquedaN.value);">
                              <i class="fas fa-search" style="color: white;"></i>
                              </button>
                          </div>
                      </form>    
                </div>
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12" style="text-align: left;">
                      <form [formGroup]="formBusquedaCU" class="login100-form validate-form flex-sb flex-w animated text-center">
          
                          <div class="input-group justify-content-center" style="align-items: center;">
                              <div id="search-autocomplete" class="form-outline">
                              <input type="search" id="form1" class="form-control"  maxlength="6" formControlName="nombre" id="BCU"  style="border-bottom: 1px solid silver; height: 2.5em;" placeholder=""/>
                              <label class="form-label" for="form1">Código Único Producto</label>
                              </div>
                              <button [disabled]="formBusquedaCU.invalid" type="submit" class="btn btnTrash"  (click)="buscarProductoNombreUnico(formBusquedaCU.value);">
                              <i class="fas fa-search" style="color: white;"></i>
                              </button>
                          </div>
                      </form>    
                </div>
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12" style="text-align: left;">
                      <form [formGroup]="formBusquedaCB" class="login100-form validate-form flex-sb flex-w animated text-center">
          
                          <div class="input-group justify-content-center" style="align-items: center;">
                              <div id="search-autocomplete" class="form-outline">
                              <input type="search" id="form1" class="form-control"  formControlName="nombre"  style="border-bottom: 1px solid silver; height: 2.5em;" placeholder=""/>
                              <label class="form-label" for="form1">Código de Barras</label>
                              </div>
                              <button  [disabled]="formBusquedaCB.invalid" type="submit" class="btn btnLupa"  (click)="buscarProductoCodBarras(formBusquedaCB.value);">
                              <i class="fas fa-search" style="color: white;"></i>
                              </button>
                          </div>
                      </form>    
                </div>
                    <!-- <div class=" col-xl-5  col-lg-5 col-md-5 col-sm  " style="text-align: center;" >
                      <button  class="btn" style=" background-color: #03a9f4; color: white;  font-size: 12px; height: 3.5em;
                      font-family: 'Ubuntu';
                      font-weight: bold;"><i class="fas fa-plus"></i> Crear Producto</button>
                    </div> -->
              
                  </div>
              </div>
          
                <h1 class="mt-4">
                  Mano de obra - Servicios
              </h1>
              <div class="table-responsive">

                <table mdbTable #tableEl="mdbTable" class="">
                    <thead class="thead1 text-center">
                        <tr>
                            <th scope="col">Técnico</th>
                            <th scope="col">Servicio</th>
                            <th scope="col">Cod.</th>
                            <th scope="col">Mano-Obra</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Precio Unitario</th>
                            <th scope="col">Precio Total</th>
                            <th   scope="col">Acciones</th>                    
                        </tr>
                    </thead>
                    <tbody class="tbody text-center">
                      <ng-container *ngFor="let el of productos; let i = index">
                        <tr *ngIf="el.esservicio == '1'">
                          <th>{{el.tecnico_nombres |titlecase}} {{el.tecnico_apellidos | titlecase}}</th>
                        <input hidden formControlName="tecnico_id" value="{{el.tecnico_id}}">
                        <td>{{el.tipo}}</td>
                        <input formControlName="tiposervicio_id" value="{{el.tiposervicio_id}}" hidden>
                        <td>{{el.producto_id}}</td>
                        <input formControlName="producto_id" value="{{el.producto_id}}" hidden>
                        
                        <td *ngIf="el.alias != ''"  >
           
                          {{el.alias }} <i class="far fa-eye"  type="button" style="color: #F51F36;"
                          mdbPopover="{{el.productname}}"
                          placement="right"
                          mdbPopoverHeader="Nombre del producto" ></i>
                        </td>
                        <input formControlName="alias" value="{{el.alias}}" hidden>
                        <td *ngIf="el.alias == ''"  >                     
                          {{el.productname |uppercase}} 
      
                        </td>
                        <input formControlName="productname" value="{{el.productname}}" hidden>
                        <td>{{el.cant}}</td>
                        <input  formControlName="cant" value="{{el.cant}}" hidden>
                        <td>$ {{el.itemprecio  |currency:'':'':'1.2-2'}}</td>            
                                    <input formControlName="itemprecio" value="{{el.itemprecio}}" hidden>
                                    <input formControlName="ivaporcent" value="{{el.ivaporcent}}" hidden>
                                    <input formControlName="iva" value="{{el.iva}}" hidden>
                                    <input formControlName="total" value="{{el.total}}" hidden>
                                    <input formControlName="bodega_id" value="{{el.bodega_id}}" hidden>
                                    <input formControlName="esservicio" value="{{el.esservicio}}" hidden>
                        <th>$ {{el.itemprecio * el.cant  |currency:'':'':'1.2-2'}}</th>
                        <input hidden formControlName="costopromedio" value="{{el.costopromedio}}">
                        <td  >
                          <div class="button-group btn-group-sm" style="width: 9em;">

                              <button type="button" class="btn btnEdit"  data-toggle="modal" data-target="#exampleModal" (click)="enviarPedido(productos, i)" ><i class="fas fa-pencil-alt"></i></button>
                              <button type="button" class="btn  btnTrash "(click)="quitarProducto(i, productos)"><i class="fas fa-trash "></i> </button>
                          </div>
                      </td>
      
                        </tr>
                      </ng-container>
      
                    
                    </tbody>
                </table>
            </div>
 
              <h1 class="mt-4">
                Repuestos Utilizados
            </h1>
            <div class="table-responsive" >

              <table mdbTable #tableEl="mdbTable" class="">
                  <thead class="thead1 text-center">
      
                      <tr>
                          <th scope="col">Técnico</th>
                          <th scope="col">Servicio</th>
                          <th scope="col">Cod.</th>
                          <th scope="col">Item</th>
                          <th scope="col" >Cantidad</th>
                          <th scope="col">Precio Unitario</th>
                          <th scope="col">Precio Total</th>
                          <th    scope="col">Acciones</th>
                      </tr>
                  </thead>
      
                  <tbody class="tbody text-center">
                    <ng-container *ngFor="let el of productos; let i=index">
                      <tr *ngIf="el.esservicio == '0'">
                        <th>{{el.tecnico_nombres |titlecase}} {{el.tecnico_apellidos | titlecase}}</th>
                        <input hidden formControlName="tecnico_id" value="{{el.tecnico_id}}">
                        <td>{{el.tipo}}</td>
                        <input formControlName="tiposervicio_id" value="{{el.tiposervicio_id}}" hidden>
                        <td>{{el.producto_id}}</td>
                        <input formControlName="producto_id" value="{{el.producto_id}}" hidden>
                        <td *ngIf="el.alias != ''"  >
                          {{el.alias }} <i class="far fa-eye"  type="button" style="color: #F51F36;"
                          mdbPopover="{{el.productname}}"
                          placement="right"
                          mdbPopoverHeader="Nombre del producto" ></i>
      
                        </td>
                        <input formControlName="alias" value="{{el.alias}}" hidden>
                        <td *ngIf="el.alias == ''"  >{{el.productname}}</td>
                        <input formControlName="productname" value="{{el.productname}}" hidden>
                        <td>{{el.cant}}</td>
                        <input  formControlName="cant" value="{{el.cant}}" hidden>
                        <td>$ {{el.itemprecio |currency:'':'':'1.2-2'}}</td>            
                                    <input formControlName="itemprecio" value="{{el.itemprecio}}" hidden>
                                    <input formControlName="ivaporcent" value="{{el.ivaporcent}}" hidden>
                                    <input formControlName="iva" value="{{el.iva}}" hidden>
                                    <input formControlName="total" value="{{el.total}}" hidden>
                                    <input formControlName="bodega_id" value="{{el.bodega_id}}" hidden>
                                    <input formControlName="esservicio" value="{{el.esservicio}}" hidden>
                        <th>$ {{el.itemprecio * el.cant |currency:'':'':'1.2-2'}}</th>
                        <input hidden formControlName="costopromedio" value="{{el.costopromedio}}">
                        <td  >
                          <div class="button-group btn-group-sm" style="width: 9em;">
                             
                              <button type="button" class="btn btnEdit"  data-toggle="modal" data-target="#exampleModal" (click)="enviarPedido(productos, i)" ><i class="fas fa-pencil-alt"></i></button>
                              <button type="button" class="btn  btnTrash "(click)="quitarProducto(i, productos)"><i class="fas fa-trash "></i> </button>
                          </div>
                      </td>
                      </tr>
                  
                    </ng-container>
                  </tbody>
                  <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td style="font-weight: bold;">TOTAL:</td>
                    <td  style="font-weight: bold;"> $ {{total|currency:'':'':'1.2-2'}}</td>
                    <td></td>
                </tr>
              </table>
          </div>
             
          </div>
          <div class="divSelect mt-4 mb-4">
            <button class="btn bExit btO" data-dismiss="modal"><i class="fas fa-times"></i> Cancelar </button>
            <button class="btn bSave btO" (click)="modificarCotizacion(formEditarPYS.value, productos)"><i class="fas fa-save"></i> Guardar </button>
          </div>
          
           </form>
  
      </div>
      </div>
     <!-- </ng-template> -->
      </div>
  </div>

   <!-- ================================================================ TABLA PARA SELECCIONAR PRODUCTOS O SERVICIOS ========================================================================== -->
   <!-- <ng-template #modalSelecionarPC class="modal fade" > -->
    <div class="modal fade bd-example-modal-xl"   id="modalTyS" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="overflow-y: scroll;">
      <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="table-responsive" style="width: 95%; margin-left: 3%; margin-right: 3%;">
        <div class="form-header mt-4">
            <h1 class="" id="tituloForm">Seleccionar producto o servicio</h1>
        </div>
        <form [formGroup]="formProductoServicio">

            <table class="table">
                <thead class="thead1 text-center" >
                <tr>
                    <th scope="col">Cod</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Stock</th>
                    <th scope="col">Precio</th>
                    <th scope="col">Cantidad</th>
                    <th scope="col">Técnico</th>
                    <th scope="col">Servicio</th>
                    <th scope="col">Acciones</th>
                </tr>
                </thead>
                <tbody  class="text-center">
                <tr  *ngFor="let el of ps;let i =index" >
                  <th scope="col">
                    {{el.id_producto}}
                  </th>
                  <td>
                    {{el.pro_nom}} <i class="far fa-eye" type="btn"  style="color: black"  (click)="desplegarAlias(i)" id="iAA{{i}}" ></i> <i class="fas fa-minus" id="iAC{{i}}" hidden style="color: #007bff" (click)="ocultarAlias(i)"></i>
                    <input hidden class="form-control form-control-sm"  style="text-transform: uppercase;" id="verAlias{{i}}" placeholder="Ingrese alias" formControlName="alias"> 
                  </td>
                  <td >
                    {{el.stock | number: '1.0-0'}} 
                    <input hidden class="form-control form-control-sm" value="{{el.stock}}" id="stock{{i}}">                   
                  </td>

                  <td >
                    <input  class=" form-control form-control-sm"  id="precioItem{{i}}" value="{{el.valor  |currency:'':'':'1.2-2' }}" style="width: 5.5em;" >
                </td>
                  <td>
                    <input   formControlName="cantidad" type="number" class="form-control cantidad form-control-sm " id="cantidad{{i}}" style="height: 2.5em ;width: 4em;" placeholder="" min="0" oninput="this.value = 
                    !!this.value && Math.abs(this.value) >= 0 ? Math.abs(this.value) : null" value="">
                  </td>
                  <td>
                    <select style="height: 2.5em; width: 12em;" formControlName="tecnicoS"  class="form-control form-control-sm " id="selectT" >
                        <option *ngFor="let tec of tecnicos" value="{{ tec.id }}" 
                        >
                            {{ tec.nombres | titlecase }} {{ tec.apellidos | titlecase }}
                          </option>                               
                    </select> 
                  </td>
                  <td>
                    <select 
                    style="height: 2.5em ; width: 12em;"
                    formControlName="servicio"  class="form-control  form-control-sm"
                    >
                        <option *ngFor="let ser of servicios" value="{{ ser.id }}">
                            {{ ser.tipo | titlecase }}
                          </option>
                        
                    </select> 
                  </td>
                  <td>
                    <div class="button-group btn-group-sm">
                        <button class="btn btn-success" (click)="agregarProducto1(el, i, formProductoServicio.value)"><i class="fas fa-cart-plus" style="height: 1em;"></i> </button>
                    </div>
                  </td>
         
                </tr>
                </tbody>
              </table>  
              
              <div *ngIf="banderaPaginacion" class="d-flex justify-content-center mt-4 divSelect" >
                <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize" (pageChange)="refreshPyS()">
                </ngb-pagination>
              </div>           
        </form>    
      </div>
    <div class=" button group row m-3 ">
        <button type="button" class="btn col btn-md btnModal " data-dismiss="modal"  aria-label="Close" ><i class="fas fa-window-close"></i> Salir</button>        
    </div>
    </div>
      </div>
    </div>
    
<!-- </ng-template> -->

<!-- ================================================= MODAL EDITAR CANTIDAD PRODUCTO =============================================== -->
<!-- Modal -->

<!-- <ng-template #modalEditarP class="modal fade" >
  <div class="modal-content"> -->
    <!-- <div class="modal fade bd-example-modal-xl"   id="bd-example-modal-xl1" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
    <div class="modal-content">
              <h1 class="modal-title" id="exampleModalLongTitle">Editar Producto/Servicio</h1>
              <button type="button" class="btn" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
          </div>
          <form [formGroup]="formCantidad">
              <div class="modal-body">
                  <div class="divSelect">
                      <ng-container *ngFor="let ped of productoFormCantidad">
                          <div class="col" >
                              <strong>Cantidad <i class="fas fa-hashtag"></i></strong>
                              <input formControlName="c" type="number" class="form-control cantidad" id="cantidad" style="height: 2.5em;"  min="1" oninput="this.value = 
                              !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null" value="">
 
                          </div>
                          <div class="col" *ngIf="productoFormCantidad[0].esservicio == '1'" >
                              <strong>Precio Unitario <i class="fas fa-dollar-sign"></i></strong> 
                              <input formControlName="precio" type="number" class="form-control cantidad" id="cantidad" style="height: 2.5em;"  min="1" oninput="this.value = 
                              !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null" value="">
 

                          </div>
                    </ng-container>
                  </div>
              </div>
              <div class="button-group divSelect mt-2 mb-4">
                  <button type="button" class="btn btn-primary btO" aria-label="Close" ><i class="fas fa-times"></i> Salir </button>
                  <button *ngFor="let ped of productoFormCantidad; let i=index" type="button" class="btn   btO" style="background-color: #03A9F4; color: white; " (click)="modificarCantidad(formCantidad.value,productos)"><i class="fas fa-save"></i> Guardar </button>
              </div>
          </form>
      </div>
    </div>
 -->


    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog  modal-dialog-centered" role="document">
        <div class="modal-content">

        <div class="modal-body">
          <form class="login100-form validate-form flex-sb flex-w animated text-center" style="color: #757575;" [formGroup]="formCantidad" >

              <div class=" ml-4 mr-4">

                  <!-- SELECCIONAR TECNICO -->

                  <div class="form-group">
                      <label for="username" id="tituloF">Técnico <i class="fas fa-user-cog"></i></label>
                      <div class="mb-2">
                          <select class="custom-select" formControlName="nombreT" id="selectModal">
                              <option value="{{idTecSeleccionado}}">{{tecSeleccionado |titlecase}}</option>
                              <ng-container *ngFor="let el of tecnicos" >
                                  <option *ngIf="el.nombres != tecNombre  " value="{{el.id}}">{{el.nombres | titlecase}} {{el.apellidos | titlecase}}</option>
                              </ng-container>
                          </select>
                      </div>
                  </div>
                   <!-- SELECCIONAR SERVICIO -->
                  <div class="form-group">
                      <label for="username" id="tituloF">Servicio <i class="fas fa-tools"></i></label>
                      <div class="mb-2">
                          <select class="custom-select" formControlName="nombreS" id="selectModal">
                              <option value="{{idServSeleccionado}}">{{servSelecccionado}}</option>
                              <ng-container *ngFor="let el of servicios" >
                                  <option  *ngIf="el.tipo !=  servSelecccionado  " value="{{el.id}}">{{el.tipo}}</option>
                              </ng-container>
                              

                          </select>
                      </div>
                  </div>
                           <!-- INGRESAR NOMBRE DE ALIAS -->

                           <div class="form-group" >
                              <label for="username" id="tituloF">Alias del Producto<i class="fas fa-signature"></i></label>
                              <input   id="username"  formControlName="nombreA" type="text" name="username" class="form-control form-icon-trailing entrada1" id="floatingInputNombre" required="required"
                              />    
                          </div>
                           <!-- INGRESAR CANTIDAD - PRECIO -->

                           <div class="form-group">
                               <div class="row">
                                   <div class="col">
                                      <label for="username" id="tituloF">Cantidad <i class="fas fa-hashtag"></i></label>
                                      <input formControlName="c" type="number" class="form-control cantidad" id="floatingInputNombre"  style="height: 2.5em;"  min="1" oninput="this.value = 
                                      !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null" value="">
                                   </div>
                                   <div class="col">
                                      <label for="username" id="tituloF">Precio <i class="fas fa-dollar-sign"></i></label>
                                          <input formControlName="precio" type="number" class="form-control decimales"  id="floatingInputNombre" style="height: 2.5em;"  min="1" pattern="^[0-9]+" >
                                   </div>
                               </div>
                          </div>
              </div>


              <hr>
              <div class=" button group row m-3 ">

                  <button type="button" class="btn col btn-md  btnGuardar "  data-dismiss="modal" ><i class="fas fa-window-close"></i> Cancelar</button>
                  <button type="submit" class="btn col btn-md btnModal"  id="btnGuardar" (click)="modificarCantidad(formCantidad.value,productos)"><i class="fas fa-save "></i>  Guardar cambios</button>

              </div>

          </form>
       
      </div>

        </div>
      </div>
    </div>
    
<!-- </ng-template> -->

<!-- ========================== MODAL CONTROLAR STOCK ==================================== -->

<ng-template #modalListarStock class="modal fade" >
  <div class="modal-content">

      <h1 class="mt-4"><i class="fas fa-exclamation-circle text-danger"></i></h1>

      <h5 style="font-size: 1em;" >{{data.msg}}</h5>
      <table class="table table-bordered" style="width: 95%; margin-left: 1em; margin-right: 1em; " >
        <thead class="thead-light" style="vertical-align: middle;">
          <tr class="text-center font-weight-bold" >
            <th scope="col">Nombre o Alias</th>
            <th scope="col">Cantidad</th>
            <th scope="col">Stock</th>
          </tr>
        </thead>
        <tbody>
          <tr class="text-center" *ngFor="let el of data.id" style="vertical-align: middle;">
            <td scope="row" *ngIf="el.productname != '' && el.alias != '' " >{{el.alias }}</td>
            <td class="font-weight-bold" scope="row" *ngIf="el.alias == ''" >{{el.productname }}</td>
            <td class="text-danger font-weight-bold">{{el.cant}}</td>
            <td class="text-danger font-weight-bold">{{el.stock | number: '1.0-0'}}</td>
          
          </tr>
          
        </tbody>
      </table>
     <div class="button-group divSelect mb-2">
       <!-- <button class="btn  btn-sm btn-info" data-toggle="modal" data-target="#modalEPS" (click)="enviarPyS()" ><i class="fas fa-pencil-alt"></i> Editar Orden</button> -->
       <!-- <button class="btn  btn-sm btn-info" data-toggle="modal" data-target="#modalEPS" (click)="enviarPyS1(data.id_orden)" ><i class="fas fa-pencil-alt"></i> Editar Orden</button> -->
       <button class="btn  btn-sm btn-danger " (click)="cerrarModal1()"> <i class="fas fa-times"></i> Cerrar</button>
       

     </div>


  </div>
</ng-template>

